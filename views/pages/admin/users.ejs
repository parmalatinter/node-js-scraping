<!DOCTYPE html>
<html>
<head>
    <% include ../../partials/header.ejs %>
</head>

<body style="background:#532F8C">

<% include ../../partials/nav.ejs %>
<script type="text/javascript" src="/javascripts/user.js"></script>

<style>
    .container.users td, .container.users th {
        width: 140px;
    }

    .container.users td p.collapse[aria-expanded="false"] {
        display: block;
        height: 80px !important;
        overflow: hidden;
    }

    .container.users td p.collapsing[aria-expanded="false"] {
        height: 80px !important;
    }

    .container.users td a.collapsed:after {
        content: '+ã‚‚ã£ã¨è¦‹ã‚‹';
    }

    .container.users td a:not(.collapsed):after {
        content: '- éš ã™';
    }

    .container.users .list-group-item {
        position: relative;
        display: block;
        padding: 2px 15px;
        margin-bottom: -1px;
        background-color: #fff;
        border: 1px solid #ddd;
    }

    .container.users .list-group {
        padding-left: 0;
        margin-bottom: inherit;
    }

    .modal-content.search_condition input.big, .modal-content.search_condition select.big {
        width: 100%;
    }

    .modal-dialog {
        max-width: 650px;
    }
</style>
<div class="container users">
    <form action="/admin/user" method="post">
        <!-- Large modal -->
        <button type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#search_user">æ¤œç´¢æ¡ä»¶
        </button>
        <button class="btn btn-primary" type="submit">
            æ¤œç´¢
        </button>
        <button type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#set_is_enable_send">æ¡ä»¶ã‚’é€ä¿¡æ¡ä»¶ã«åæ˜ 
        </button>
        <button type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#un_set_is_enable_send">æ¡ä»¶ã‚’é€ä¿¡æ¡ä»¶ã‹ã‚‰å¤–ã™
        </button>
        <br><br>
        <div class="panel panel-default">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                    <tr style="background: lightgray;">
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  <input class="form-check-input"
                                                                                              type="checkbox"
                                                                                              name="sort[]"
                                                                                              value="name"
                                            <%= valid_sort.name == 'name' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">ID <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="id"
                                            <%= valid_sort.name == 'id' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">æ€§åˆ¥ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="sex"
                                            <%= valid_sort.name == 'sex' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">å¹´é½¢ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="age"
                                            <%= valid_sort.name == 'age' ? 'checked' : '' %>/></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">å±…ä½åœ° <input class="form-check-input"
                                                                                           type="checkbox" name="sort[]"
                                                                                           value="location"
                                            <%= valid_sort.name == 'location' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">å¹´å <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="salary"
                                            <%= valid_sort.name == 'salary' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">è³‡ç”£ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="asset"
                                            <%= valid_sort.name == 'asset' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">è·æ¥­ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="job"
                                            <%= valid_sort.name == 'job' ? 'checked' : '' %>/></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">èº«é•· <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="height"
                                            <%= valid_sort.name == 'height' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">ä½“å‹ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="body"
                                            <%= valid_sort.name == 'body' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">é£²é…’ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="drinking"
                                            <%= valid_sort.name == 'drinking' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">å–«ç…™ <input class="form-check-input"
                                                                                          type="checkbox" name="sort[]"
                                                                                          value="smoking"
                                            <%= valid_sort.name == 'smoking' ? 'checked' : '' %>/></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">å©šå§»çŠ¶æ³ <input class="form-check-input"
                                                                                            type="checkbox"
                                                                                            name="sort[]"
                                                                                            value="marriage"
                                            <%= valid_sort.name == 'marriage' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">äº¤éš›ã‚¿ã‚¤ãƒ— <input class="form-check-input"
                                                                                             type="checkbox"
                                                                                             name="sort[]"
                                                                                             value="dating_type"
                                            <%= valid_sort.name == 'dating_type' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">ä¼šå“¡ãƒ•ãƒ©ã‚° <input class="form-check-input"
                                                                                             type="checkbox"
                                                                                             name="sort[]"
                                                                                             value="payment_status"
                                            <%= valid_sort.name == 'payment_status' ? 'checked' : '' %>/></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">âœ‰ï¸äººæ•° <input class="form-check-input"
                                                                                            type="checkbox"
                                                                                            name="sort[]"
                                                                                            value="message_count"
                                            <%= valid_sort.name == 'message_count' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">âœï¸æŠ•ç¨¿æ•° <input class="form-check-input"
                                                                                             type="checkbox"
                                                                                             name="sort[]"
                                                                                             value="bbs_count"
                                            <%= valid_sort.name == 'bbs_count' ? 'checked' : '' %>/></a>
                                <a class="list-group-item list-group-item-info">ğŸš“è¢«é€šå ±æ•° <input class="form-check-input"
                                                                                              type="checkbox"
                                                                                              name="sort[]"
                                                                                              value="bad_reporting_count"
                                            <%= valid_sort.name == 'bad_reporting_count' ? 'checked' : '' %>/></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item list-group-item-info">ç™»éŒ²æ—¥æ™‚ <input class="form-check-input"
                                                                                            type="checkbox"
                                            <%= valid_sort.name == 'registered_at' ? 'checked' : '' %>
                                                                                            name="sort[]"
                                                                                            value="registered_at"/></a>
                                <a class="list-group-item list-group-item-info">ä½œæˆæ—¥æ™‚ <input class="form-check-input"
                                                                                            type="checkbox"
                                            <%= valid_sort.name == 'created_at' ? 'checked' : '' %>
                                                                                            name="sort[]"
                                                                                            value="created_at"/></a>
                                <a class="list-group-item list-group-item-info">æ›´æ–°æ—¥æ™‚ <input class="form-check-input"
                                                                                            type="checkbox"
                                            <%= valid_sort.name == 'update_at' ? 'checked' : '' %>
                                                                                            name="sort[]"
                                                                                            value="update_at"/></a>
                            </div>
                        </th>
                    </tr>
                    <tr style="background: lightgray;">
                        <th>
                            <div class="list-group">
                                <a class="list-group-item">ç”»åƒ<br><br></a>
                            </div>
                        </th>
                        <th colspan="4">
                            <div class="list-group">
                                <a class="list-group-item">å†…å®¹<br><br></a>
                            </div>
                        </th>
                        <th>
                            <div class="list-group">
                                <a class="list-group-item">
                                    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¯ <input class="form-check-input" type="checkbox" name="sort[]" value=""/><br>
                                    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¸ˆ <input class="form-check-input" type="checkbox" name="sort[]" value=""/>
                                </a>
                            </div>
                        </th>
                    </tr>
                    </thead>
                    </tbody>
                </table>
            </div>
        </div>
        <% is_enable_send = false %>
        <% modal_id = 'search_user' %>
        <% include ../../partials/modal/user_search.ejs %>
    </form>
    <form class="panel panel-default">
        <div class="table-responsive">
            <table class="table">
                <thead>
                <tbody>
                <% rows.forEach(function(r, i) { %>
                    <tr style="<%= i % 2 ? 'background:#f7f7f9' : '' %>">
                    <td>
                        <%= r.name %><br>
                        <%= r.id %><br>
                        <%= r.age %>æ‰<br>
                        <%= r.sex == 1 ? 'ç”·æ€§' : 'å¥³æ€§' %>
                    </td>
                    <td>
                        <%= r.location %><br>
                        <%= r.salary != "" ? r.salary : "-" %><br>
                        <%= r.asset != "" ? r.asset : "-" %><br>
                        <%= r.job != "" ? r.job : "-" %>
                    </td>
                    <td>
                        <%= r.height ? r.height : "-" %><br>
                        <%= r.body %><br><%= r.drinking != "" ? r.drinking : "-" %><br>
                        <%= r.smoking != "" ? r.smoking : "-" %>
                    </td>
                    <td><%= r.marriage != "" ? r.marriage : "-" %><br>
                        <%= r.dating_type != "" ? r.dating_type : "-" %><br>
                        <% if (r.payment_status === 'PREMIUM') { %>
                        <span class="label label-danger">ğŸ‘‘</span>
                        <% } else if (r.payment_status === 'DIAMOND') { %>
                        <span class="label label-danger">ğŸ’</span>
                        <% } else { %>
                        -
                        <% } %>
                    </td>
                    <td>
                        âœ‰ï¸<%= r.message_count %><br>
                        âœï¸<%= r.bbs_count %><br>
                        ğŸš“<%= r.bad_reporting_count %></td>
                    <td>
                        <%= moment(r.created_at).format("YYYY-MM-DD") %><br>
                        <%= moment(r.registered_at).format("YYYY-MM-DD") %><br>
                        <% if (r.update_at) { %>
                        <%= moment(r.update_at).format("YYYY-MM-DD") %>
                        <% } else { %>
                        -
                        <% } %>
                    </td>
                </tr>
                    <tr style="<%= i % 2 ? 'background:#f7f7f9' : '' %>">
                    <td>
                        <div style="height: 150px;
            overflow: hidden;
            vertical-align: middle;">
                            <% if (r.is_image) { %>
                            <img class="img-thumbnail" width="150px" src="/img/user/user_<%= r.id %>.png">
                            <% } else if(r.sex == 1){ %>
                            <img class="img-thumbnail" width="150px" src="/img/default_men.png">
                            <% } else if(r.sex == 2){ %>
                            <img class="img-thumbnail" width="150px" src="/img/default_women.png">
                            <% } %>
                        </div>
                    </td>
                    <td colspan="4" width="70%"><p class="collapse" id="collapse<%= i %>"
                                                   aria-expanded="false"><%= r.about %></p>
                        <% if (r.about.length > 198) { %>
                        <a role="button" class="collapsed" data-toggle="collapse" href="#collapse<%= i %>"
                           aria-expanded="false" aria-controls="collapse<%= i %>">
                        </a>
                        <% } %>
                    </td>
                    <td colspan="2">
                        âœ‰ï¸é€ä¿¡å¯<input type="checkbox" name="is_enable_send" class="main_is_enable_send" alt="#is_enable_send_<%= r.id %>"
                                    value="checked" <%= r.is_enable_send ? 'checked' : '' %>><br>
                        âœ‰ï¸é€ä¿¡æ¸ˆ<input type="checkbox" name="is_sent" value="true" <%= r.is_sent ? 'checked' : '' %>
                                    disabled>
                    </td>
                <tr>
                <% }); %>
                </tbody>
            </table>
        </div>
        <% url = '/admin/user'; %>
        <% include ../../partials/pagination.ejs %>
    </form>
    <form action="/admin/user/set_is_enable_send_by_ids" method="post">
        <% include ../../partials/modal/set_is_enable_send_by_ids.ejs %>
    </form>
    <form action="/admin/user/set_is_enable_send" method="post">
        <% modal_id = 'set_is_enable_send' %>
        <% is_enable_send = true %>
        <% include ../../partials/modal/user_search.ejs %>
    </form>
    <form action="/admin/user/unset_is_enable_send" method="post">
        <% modal_id = 'un_set_is_enable_send' %>
        <% is_enable_send = true %>
        <% include ../../partials/modal/user_search.ejs %>
    </form>
    <br>
    <button type="button" class="btn btn-primary" data-toggle="modal"
            data-target="#modal_set_is_enable_send_by_ids">ãƒã‚§ãƒƒã‚¯ã—ãŸç‰©ã‚’åæ˜ 
    </button>
    <br><br>
</div>
